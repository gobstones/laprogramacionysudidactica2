interactive program {
  K_ARROW_LEFT  -> { MoverseHacia(Oeste)     }
  K_ARROW_RIGHT -> { MoverseHacia(Este)      }
  K_ARROW_UP    -> { MoverseHacia(Norte)     }
  K_ARROW_DOWN  -> { MoverseHacia(Sur)       }
  K_ENTER       -> { ProcesarLaCartaActual() }
}

procedure MoverseHacia(dir) {
    if (hayCartaDestapadaSinIluminar() && hayOtraCartaDestapada()) { TaparAmbasCartasDestapadas() }
    PasarASiguienteCartaHacia_(dir)
}

procedure ProcesarLaCartaActual() {
  GirarLaCartaActualSiSePuede()
  if (hayOtraCartaDestapada() && lasCartasDestapadasSonIguales())
    { IluminarAmbasCartasDestapadas() } 
}

procedure GirarLaCartaActualSiSePuede() { if (hayCartaTapada()) { DestaparCartaActual() } }

procedure IluminarAmbasCartasDestapadas() {
  IrALaCartaOtraCartaDestapada()
  IluminarCartaActual()
  IrALaCartaOtraCartaDestapada()
  IluminarCartaActual()
}

procedure TaparAmbasCartasDestapadas() {
  IrALaCartaOtraCartaDestapada()
  TaparCartaActual()
  IrALaCartaOtraCartaDestapada()
  TaparCartaActual()
}

procedure IrALaCartaOtraCartaDestapada() {
  PasarASiguienteCarta()
  while (not hayCartaDestapadaSinIluminar()) { PasarASiguienteCarta() }
}

function hayCartaDestapadaSinIluminar() { return(hayCartaDestapada() && not hayCartaIluminada()) }

function lasCartasDestapadasSonIguales() {
  primeraCarta := leerCarta()
  IrALaCartaOtraCartaDestapada()
  segundaCarta := leerCarta()
  return (lasCartasSonIguales(primeraCarta, segundaCarta))
}

function lasCartasSonIguales(primeraCartaAControlar, segundaCartaACotrolar) {
  return (valor(primeraCartaAControlar) == valor(segundaCartaACotrolar)
       && palo(primeraCartaAControlar)  == palo(segundaCartaACotrolar)
         )
}
